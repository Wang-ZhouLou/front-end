<template>
	<div>
<<<<<<< Updated upstream
		<input type="text" placeholder="输入关键字搜索" v-model="search" />
		<el-button style="background-color: #009688;color: white;" size="mini">查询</el-button>
	</div>&nbsp;
	<div>
		<el-table :data="dropData" border style="width: 100%">
			<el-table-column type="selection" width="55" align="center">
			</el-table-column>
			<el-table-column label="退学编号" prop="dropId" width="80" align="center">
			</el-table-column>
			<el-table-column label="学号" prop="courserecorddetailsVo.studentVo.studentId" width="130" align="center">
			</el-table-column>
			<el-table-column label="课程名称" prop="courserecorddetailsVo.courseVo.courseName" width="140" align="center">
			</el-table-column>
			<el-table-column label="班级" prop="courserecorddetailsVo.classesVo.classesName" width="140" align="center">
			</el-table-column>
			<el-table-column label="退学时间" prop="dropRime" width="150" align="center">
			</el-table-column>
			<el-table-column label="退学理由" prop="dropReason" width="140" align="center">
			</el-table-column>
			<el-table-column label="退学办理人" prop="dropHandler" width="140" align="center">
			</el-table-column>
			<el-table-column label="退费状态" prop="ispay" width="140" align="center">
				<template v-slot="scope">
					<p v-if="scope.row.ispay==0">未缴费</p>
					<p v-if="scope.row.ispay==1">待缴费</p>
					<p v-if="scope.row.ispay==2">已缴费</p>
				</template>
			</el-table-column>
			<el-table-column label="审核状态" prop="jwApproval" width="140" align="center">
				<template v-slot="scope">
					<p v-if="scope.row.jwApproval==0">未审核</p>
					<p v-if="scope.row.jwApproval==1">已审核</p>
				</template>
			</el-table-column>
			<el-table-column fixed="right" label="操作" align="center">
				<template #default="scope">
					<el-button @click="updateLearningstate6(scope.row)" type="text" size="small">审核通过</el-button>
					<el-button @click="deleteDrop(scope.row)" type="text" size="small">删除</el-button>
				</template>
			</el-table-column>

		</el-table>&nbsp;
	</div>
=======
		<div>
			<input type="text" placeholder="输入关键字搜索" v-model="search" />
			<el-button style="background-color: #009688;color: white;" size="mini">查询</el-button>
			<el-button style="background-color: #5FB878;color: white;" size="mini">审核通过</el-button>
		</div>&nbsp;
		<div>
			<el-table
				:data="dropData"
				border style="width: 100%">
				<el-table-column type="selection" width="55" align="center">
				</el-table-column>
				<el-table-column label="" prop="dropId" width="80" align="center">
				</el-table-column>
				<el-table-column label="学号" prop="studentVo.studentId" width="130" align="center">
				</el-table-column>
				<el-table-column label="课程名称" prop="courseVo.courseName" width="140" align="center">
				</el-table-column>
				<el-table-column label="班级" prop="classesVo.classesName" width="140" align="center">
				</el-table-column>
				<el-table-column label="退学时间" prop="dropRime" width="150" align="center">
				</el-table-column>
				<el-table-column label="退学理由" prop="dropReason" width="140" align="center">
				</el-table-column>
				<el-table-column label="退学办理人" prop="dropHandler" width="140" align="center">
				</el-table-column>
				<el-table-column label="退费状态" prop="ispay" width="140" align="center">
					<template v-slot="scope">
						<p v-if="scope.row.ispay==0">未缴费</p>
						<p v-if="scope.row.ispay==1">待缴费</p>
						<p v-if="scope.row.ispay==2">已缴费</p>
					</template>
				</el-table-column>
				<el-table-column label="审核状态" prop="jwApproval" width="140" align="center">
					<template v-slot="scope">
						<p v-if="scope.row.jwApproval==0">未审核</p>
						<p v-if="scope.row.jwApproval==1">已审核</p>
					</template>
				</el-table-column>
			</el-table>&nbsp;
			<!-- <el-pagination style="text-align: center;" background :page-size="5" layout="prev, pager, next" :total="50"> -->
				<!-- 总条数 -->
			<!-- </el-pagination> -->
		</div>

	</div><!-- 分页 -->
>>>>>>> Stashed changes
	<div class="block" style="display: flex;justify-content: center;margin-top: 10px;">
		<el-pagination @size-change="handleSizeChange" @current-change="handleCurrentChange"
			:current-page="pageInfo.currentPage" :page-sizes="[2, 4, 6, 8]" :page-size="pageInfo.pagesize"
			layout="total, sizes, prev, pager, next, jumper" :total="pageInfo.total">
		</el-pagination>
	</div>
</template>

<script>
	export default {
		methods: {
			handleEdit(index, row) {
				console.log(index, row);
			},
			handleDelete(index, row) {
				console.log(index, row);
			},
			deleteDrop(row) {
				const _this = this
				var flag = true // eslint-disable-line no-unused-vars
				this.$confirm('此操作将永久删除该数据, 是否继续?', '提示', {
					confirmButtonText: '确定',
					cancelButtonText: '取消',
					type: 'warning',
					
				}).then(() => {
					console.log(row);
					_this.axios.put("http://localhost:8089/tsm/deleteDrop", row, {
							headers: {
								'content-type': 'application/json',
								'jwtAuth': _this.$store.getters.token
							}
						})
						.then(function(response) {
							console.log(response)
							var rows = _this.dropData
								.filter( a => a.dropId != row.dropId)
							_this.dropData = rows
							_this.pageInfo.total = _this.pageInfo.total - 1
						}).catch(function(error) {
							console.log(error)
						})
				}).catch(() => {
					this.$message({
						type: 'error',
						message: '取消删除!'
					});
				});
			},
			updateLearningstate6(row) {
				const _this = this
				var flag = true // eslint-disable-line no-unused-vars
				this.$confirm('此操作将审批学员, 是否继续?', '提示', {
					confirmButtonText: '确定',
					cancelButtonText: '取消',
					type: 'warning'
				}).then(() => {
					
					console.log(row.courserecorddetailsVo.courserecorddetailsId);
					_this.axios.put("http://localhost:8089/tsm/updateLearningstate6", row.courserecorddetailsVo, {
							headers: {
								'content-type': 'application/json',
								'jwtAuth': _this.$store.getters.token
							}
						})
						.then(function(response) {
							 console.log(response)
							// console.log("+++++++++++++++++++++")
							// console.log(row)
							
							//_this.dropData = rows
						}).catch(function(error) {
							console.log(error)
						})
						this.updateDropJW_Approval1(row);
						
				}).catch(() => {
					this.$message({
						type: 'error',
						message: '取消审批!'
					});
				});
			},
			updateDropJW_Approval1(row) {
				const _this = this
					this.axios.put("http://localhost:8089/tsm/updateDropJW_Approval1", row, {
							headers: {
								'content-type': 'application/json',
								'jwtAuth': _this.$store.getters.token
							},
						})
						.then(function(response) {
							console.log(response)
						}).catch(function(error) {
							console.log(error)
						})
						this.selectAllDrop();
				 },
				 selectAllDrop(){
					 const _this = this
					 this.axios.get("http://localhost:8089/tsm/selectAllDrop", {
					 		headers: {
					 			'content-type': 'application/json',
					 			'jwtAuth': _this.$store.getters.token
					 		},
					 		params: _this.pageInfo
					 	})
					 	.then(function(response) {
					 		console.log("+++++++++++++++++++++++++++++++++++")
					 		console.log(response)
					 		_this.dropData = response.data.list
					 		_this.pageInfo.total = response.data
					 	}).catch(function(error) {
					 		console.log(error)
					 	})
				 }
		},
		data() {
			return {
				dropData: [],
<<<<<<< Updated upstream
				CourseRecorddetailData: [],
=======
				CourseRecorddetailData:[
					
				],
>>>>>>> Stashed changes
				search: '',
				dialogFormVisible3: false,
				formLabelWidth: '120px',
				pageInfo: {
					currentPage: 1,
					pagesize: 3,
					total: 0
<<<<<<< Updated upstream
				}
=======
				},
>>>>>>> Stashed changes
			}
		},
		created() {
			const _this = this
			this.axios.get("http://localhost:8089/tsm/selectAllDrop", {
<<<<<<< Updated upstream
					headers: {
						'content-type': 'application/json',
						'jwtAuth': _this.$store.getters.token
					},
					params: _this.pageInfo
				})
				.then(function(response) {
					console.log("+++++++++++++++++++++++++++++++++++")
					console.log(response)
					_this.dropData = response.data.list
					_this.pageInfo.total = response.data
				}).catch(function(error) {
					console.log(error)
				})
			this.axios.get("http://localhost:8089/tsm/selectAllCourseRecorddetail", {
					headers: {
						'content-type': 'application/json',
						'jwtAuth': _this.$store.getters.token
					}
				})
=======
							headers: {
								'content-type': 'application/json',
								'jwtAuth': _this.$store.getters.token
							},
								params: _this.pageInfo
							})
>>>>>>> Stashed changes
				.then(function(response) {
					console.log("+++++++++++++++++++++++++++++++++++")
					console.log(response)
<<<<<<< Updated upstream
					_this.CourseRecorddetailData = response.data
				}).catch(function(error) {
					console.log(error)
				})
		}


=======
					_this.dropData = response.data.list
					_this.pageInfo.total = response.data
				}).catch(function(error) {
					console.log(error)
				})
				this.axios.get("http://localhost:8089/tsm/selectAllCourseRecorddetail", {
						headers: {
							'content-type': 'application/json',
							'jwtAuth': _this.$store.getters.token
						}
					})
					.then(function(response) {
						console.log(response)
						_this.CourseRecorddetailData = response.data
					}).catch(function(error) {
						console.log(error)
					})
			
				
			 }
			
			
>>>>>>> Stashed changes
	}
</script>

<style>
</style>
